<% if users.empty? %>
  <h2>Sorry no user found</h2>
<% else %>
  <% answers = current_user.answers.pluck(:answer) %>
  <h3 class="requests-header">Nanas nearby...</h3>
  <% users.each do |user| %>
    <div class="d-flex justify-content-between align-items-center mx-2">
      <%= link_to your_profile_path(user.id) do %>
      <div class="card-product">
        <% if  user.photo.attached? %>
          <%= cl_image_tag user.photo.key, class:"avatar-large" %>
        <% else %>
          <%= image_tag "default-avatar.png", class:"avatar-large" %>
        <% end %>
        <div class="card-product-infos">
          <h6><%= user.firstname %> <%= user.lastname %></h6>
          <% nana_coordinates = user.address %>
          <p><%= user.distance_from_you %> km away from you</p>
          <p><%= user.motto %></p>
          <% match_value = current_user.calculate_match(user, answers) %>
          <% if match_value == 0 %>
            <p>Sorry, no match data</p>
          <% else %>
            <div class="progress mt-2">
              <% if match_value < 50 %>
                <div class="progress-bar" id="bar-under" role="progressbar" style= "width: <%= "#{match_value}%" %>" aria-valuenow="<%= match_value %>" aria-valuemin="0" aria-valuemax="100"><%= match_value %>%</div>
              <% else %>
                <div class="progress-bar" id="bar-over" role="progressbar" style= "width: <%= "#{match_value}%" %>" aria-valuenow="<%= match_value %>" aria-valuemin="0" aria-valuemax="100"><%= match_value %>%</div>
              <% end %>
            </div>
          <% end %>
        </div>
        <div>
          <i class="fas fa-chevron-right p-5"></i>
        </div>
      </div>
      <% end %>
    </div>
  <% end %>
<% end %>

<div class="btn-sm-bottom">
  <%= link_to show_nanas_nearby_path do%><i class='fas fa-sync' style="opacity: 0.7"></i><% end %>
  <%= link_to "Refresh search", show_nanas_nearby_path, remote: true, id: "show_nanas_nearby", style: 'opacity: 0.7' %>
</div>



