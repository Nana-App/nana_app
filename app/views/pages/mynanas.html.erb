<%= render 'shared/navbar-nana' %>
<div>
  <% if @friends_requested.present? %>
    <h3 class="requests-header">Friend requests</h3>
      <% @friends_requested.each do |friend_requested| %>
      <div class="d-flex justify-content-between align-items-center ml-2 mr-3">
        <%= link_to your_profile_path(friend_requested.id) do %>
        <div class="card-product w-100">
            <% if friend_requested.photo.attached? %>
              <%= cl_image_tag friend_requested.photo.key, class:"avatar" %>
            <% else %>
              <%= image_tag "default-avatar.png" %>
            <% end %>
          <div class="card-product-infos">
            <h6><%= friend_requested.firstname  %></h6>
            <% if current_user.calculate_match(friend_requested) == 0 %>
              <p>Sorry, no matching</p>
            <% else %>
              <div class="progress mt-2">
                <% if current_user.calculate_match(friend_requested) < 50 %>
                  <div class="progress-bar" id="bar-under" role="progressbar" style= "width: <%= "#{current_user.calculate_match(friend_requested)}%" %>" aria-valuenow="<%= current_user.calculate_match(friend_requested) %>" aria-valuemin="0" aria-valuemax="100"><%= current_user.calculate_match(friend_requested) %>%</div>
                <% else %>
                  <div class="progress-bar" id="bar-over" role="progressbar" style= "width: <%= "#{current_user.calculate_match(friend_requested)}%" %>" aria-valuenow="<%= current_user.calculate_match(friend_requested) %>" aria-valuemin="0" aria-valuemax="100"><%= current_user.calculate_match(friend_requested) %>%</div>
                <% end %>
              </div>
              <% end %>
          </div>
        </div>
          <div class="d-flex align-items-center" >
            <%=link_to accept_friend_path(friend_requested.id), method: :patch do %>
              <i class="fas fa-check-circle pr-1"></i>
            <% end %>
            <%=link_to reject_friend_path(friend_requested.id), method: :patch do %>
              <i class="fas fa-times-circle"></i>
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>

<div>
  <% if @friends.present? %>
    <h3 class="requests-header mt-5">My friends</h3>
    <% @friends.each do |friend|%>
      <div class="d-flex justify-content-between align-items-center ml-2 mr-3">
        <div class="card-product">
          <% if friend.photo.attached? %>
            <%= cl_image_tag friend.photo.key, class:"avatar" %>
          <% else %>
            <%= image_tag "default-avatar.png" %>
          <% end %>
          <div class="card-product-infos">
            <h6><%= friend.firstname %></h6>
            <p><%= friend.motto  %></p>
          </div>
        </div>
        <div class="">
          <% if friend.is_favorited?(current_user) %>
            <div id="<%= friend.id%>-box"> <!--This DIV is important for Ajax -->
              <%= link_to nana_unfriend_path(friend.id), method: :delete, remote: true  do %>
                <i class="fas fa-heart blue-heart"></i>
              <% end %>
            </div>
          <% else  %>
            <div id="<%= friend.id%>-box"> <!--This DIV is important for Ajax -->
              <%= link_to nana_friend_path(friend.id), method: :post, remote: true do %>
              <i class="fas fa-heart"></i>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>

<%= render 'shared/navigation' %>
